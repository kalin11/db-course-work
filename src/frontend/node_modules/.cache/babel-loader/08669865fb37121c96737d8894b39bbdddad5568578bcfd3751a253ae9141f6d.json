{"ast":null,"code":"import{useEffect,useState}from\"react\";import axios from\"../config/axios\";import Header from\"../components/headers/Header\";import SubjectItemList from\"../components/items/SubjectItemList\";import SubjectForm from\"../components/form/SubjectForm\";import{Pagination}from\"@mui/material\";import{useNavigate,useSearchParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Subject=_ref=>{let{subjects,setSubjects,selectedSubject,setSelectedSubject}=_ref;const[searchParams,setSearchParams]=useSearchParams();const navigate=useNavigate();const[pageNumber,setPageNumber]=useState(1);const[pageSize,setPageSize]=useState(5);const[totalPages,setTotalPages]=useState(1);const[isAdmin,setIsAdmin]=useState(false);useEffect(()=>{if(JSON.parse(sessionStorage.getItem('user'))===null){setIsAdmin(false);}else if(JSON.parse(sessionStorage.getItem('user')).role==='Администратор'){setIsAdmin(true);}},[]);useEffect(()=>{console.log(searchParams.get('course'));const getSubjects=()=>{return axios.get('/subjects',{params:{pageNumber:pageNumber-1,pageSize:pageSize,course:parseInt(searchParams.get('course'))},headers:{\"Access-Control-Allow-Origin\":\"*\"},withCredentials:true}).then(response=>{return response.data;}).catch(error=>{if(error.response.status===403){if(error.response.message===\"У вас недостаточно прав для выполнения данного действия\"){console.log(error.response);}else return axios.post('/auth/logout',null,{headers:{\"Access-Control-Allow-Origin\":\"*\"},withCredentials:true}).then(response=>{sessionStorage.clear();navigate('/');return response.data;}).catch(error=>{return error;});}return error;});};const getData=async()=>{let subjects=await getSubjects();setTotalPages(subjects.total_pages);let list=[];for(let i=0;i<subjects.content.length;i++){let id=subjects.content[i].id;let name=subjects.content[i].name;list.push({id:id,name:name});}setSubjects(list);};getData().catch(console.error);},[pageNumber,pageSize]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-[200px]\",children:[/*#__PURE__*/_jsx(SubjectItemList,{subjects:subjects,selectedSubject:selectedSubject,setSelectedSubject:setSelectedSubject}),isAdmin&&/*#__PURE__*/_jsx(SubjectForm,{courseNumber:searchParams.get('course')}),!!totalPages&&/*#__PURE__*/_jsx(Pagination,{sx:{display:'flex',justifyContent:'center',marginX:'auto'},color:\"primary\",count:totalPages,page:pageNumber,onChange:(_,num)=>{setPageNumber(num);}})]})]});};export default Subject;","map":{"version":3,"names":["useEffect","useState","axios","Header","SubjectItemList","SubjectForm","Pagination","useNavigate","useSearchParams","jsx","_jsx","jsxs","_jsxs","Subject","_ref","subjects","setSubjects","selectedSubject","setSelectedSubject","searchParams","setSearchParams","navigate","pageNumber","setPageNumber","pageSize","setPageSize","totalPages","setTotalPages","isAdmin","setIsAdmin","JSON","parse","sessionStorage","getItem","role","console","log","get","getSubjects","params","course","parseInt","headers","withCredentials","then","response","data","catch","error","status","message","post","clear","getData","total_pages","list","i","content","length","id","name","push","children","className","courseNumber","sx","display","justifyContent","marginX","color","count","page","onChange","_","num"],"sources":["/home/kalin/IdeaProjects/tinkoff-project-develop/src/frontend/src/pages/Subject.js"],"sourcesContent":["import {useEffect, useState} from \"react\";\nimport axios from \"../config/axios\";\nimport Header from \"../components/headers/Header\";\nimport SubjectItemList from \"../components/items/SubjectItemList\";\nimport SubjectForm from \"../components/form/SubjectForm\";\nimport {Pagination} from \"@mui/material\";\nimport {useNavigate, useSearchParams} from \"react-router-dom\";\n\nconst Subject = ({subjects, setSubjects, selectedSubject, setSelectedSubject}) => {\n\n    const [searchParams, setSearchParams] = useSearchParams();\n    const navigate = useNavigate();\n\n    const [pageNumber, setPageNumber] = useState(1);\n    const [pageSize, setPageSize] = useState(5);\n    const [totalPages, setTotalPages] = useState(1);\n\n    const [isAdmin, setIsAdmin] = useState(false);\n\n    useEffect(() => {\n        if (JSON.parse(sessionStorage.getItem('user')) === null) {\n            setIsAdmin(false);\n        } else if (JSON.parse(sessionStorage.getItem('user')).role === 'Администратор') {\n            setIsAdmin(true);\n        }\n    }, []);\n\n    useEffect(() => {\n        console.log(searchParams.get('course'));\n        const getSubjects = () => {\n            return axios\n                .get('/subjects', {\n                    params:\n                        {\n                            pageNumber: pageNumber - 1,\n                            pageSize: pageSize,\n                            course: parseInt(searchParams.get('course'))\n                        },\n                    headers: {\n                        \"Access-Control-Allow-Origin\": \"*\"\n                    },\n                    withCredentials: true\n                })\n                .then((response) => {\n                    return response.data;\n                })\n                .catch((error) => {\n                    if (error.response.status === 403) {\n                        if (error.response.message === \"У вас недостаточно прав для выполнения данного действия\") {\n                            console.log(error.response);\n                        } else return axios\n                            .post('/auth/logout', null, {\n                                headers: {\n                                    \"Access-Control-Allow-Origin\": \"*\"\n                                },\n                                withCredentials: true\n                            })\n                            .then((response) => {\n                                sessionStorage.clear();\n                                navigate('/');\n                                return response.data;\n                            })\n                            .catch((error) => {\n                                return error;\n                            })\n                    }\n                    return error;\n                });\n        }\n\n        const getData = async () => {\n            let subjects = await getSubjects();\n\n            setTotalPages(subjects.total_pages);\n\n\n            let list = [];\n            for (let i = 0; i < subjects.content.length; i++) {\n                let id = subjects.content[i].id;\n                let name = subjects.content[i].name;\n\n                list.push(\n                    {\n                        id: id,\n                        name: name\n                    }\n                );\n            }\n            setSubjects(list);\n\n        }\n        getData().catch(console.error);\n\n    }, [pageNumber, pageSize,])\n\n    return (\n        <div>\n            <Header/>\n            <div className=\"mt-[200px]\">\n                <SubjectItemList subjects={subjects}\n                                 selectedSubject={selectedSubject}\n                                 setSelectedSubject={setSelectedSubject}/>\n\n                {\n                    isAdmin &&\n                    <SubjectForm courseNumber={searchParams.get('course')}/>\n                }\n\n                {!!totalPages &&\n                    <Pagination\n                        sx={{\n                            display: 'flex',\n                            justifyContent: 'center',\n                            marginX: 'auto',\n                        }}\n                        color=\"primary\"\n                        count={totalPages}\n                        page={pageNumber}\n                        onChange={(_, num) => {\n                            setPageNumber(num);\n                        }}\n\n                    />\n                }\n\n            </div>\n        </div>\n    )\n}\n\nexport default Subject;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}